$schema: "http://dcc.icgc-argo.org/draft-00/schema#"

$id: "donor"
title: Donor
type: object
description: "Cancer patient participated research"

# this is the complete list of properties combining submitted by user and generated by the system
propertyNames:  # this will reject any unknown properties, note that 'additionalProperties: false' does not work with allOf
  anyOf:
  - pattern: '^type$'
  - pattern: '^submitter_id$'
  - pattern: '^program$'
  - pattern: '^vital_status$'
  - pattern: '^gender$'
  - pattern: '^ethnicity$'
  - pattern: '^cause_of_death$'
  - pattern: '^survival_time$'
  - pattern: '^prior_malignancy$'
  - pattern: '^cancer_type_prior_malignancy$'

definitions:
  relationDef:
    $ref: '_definitions#/relationDef'
    const:
      category: bioentity
      version: 0
      primaryKey:
      - '#/definitions/systemProperties/properties/id'
      naturalKey:
      - '#/properties/program'
      - '#/properties/submitter_id'
      uniqueKey: null
      references: null
  systemProperties:  # properties will be populated by the system
    properties:
      id:  # primary key, defined in 'primaryKey'
        allOf:
        - $ref: _definitions#/common/properties/id
        - pattern: "^DO"  # id must start with "SP", in addition to pattern defined at _definitions#/common/properties/id
      donor_id:  # foreign key to donor entity, the relationship is defined in 'references'
        $ref: donor#/systemProperties/properties/id


required:
- type
- submitter_id
- program
- gender
- vital_status

properties:
  type:
    const: "donor"
  submitter_id:
    $ref: _definitions#/common/properties/submitter_id
    description: "Submitter's donor ID"
  program:
    $ref: _definitions#/common/properties/program_short_name
  vital_status:
    enum: [ "deceased", "alive", "unknown" ]
  gender:
    enum: [ "female", "male", "other" ]
    description: "Donor biological sex"
  ethnicity:
    type: [ "string", "null" ]
    scriptValidations:
    - "$cv(ethnicity)"
  cause_of_death:
    enum: [ "died of cancer", "died of other reasons", null ]  # null means not applicable, eg, donor not deceased yet
  survival_time:
    type: integer
    minimum: 0
    description: "How long has the donor survived since primary diagnosis, in days."
  prior_malignancy:
    type: string
    scriptValidations:
    - "$cv(yes_no_unknown)"
  cancer_type_prior_malignancy:
    type: [ "string", "null" ]
    scriptValidations:
    - "$cv(cancer_type_icd_10_code)"
    description: "ICD-10 diagnostic code for type of cancer in a prior malignancy."
