$schema: "http://dcc.icgc-argo.org/draft-00/schema#"

$id: "dna_alignment_qc"
title: QC metrics of aligned DNA sequencing reads
version: 0
category: data_bundle
type: object
description: ""
additionalProperties: false

systemProperties: [ id, status ]

required:
- type
- program
- dna_alignment_id

primaryKey:
  surrogateKey: [ id ]

uniqueKeys:
- [ dna_alignment_id ]

references:
- selfKey: [ dna_alignment_id ]
  reference:
    targetEntity: dna_alignment
    targetKey: [ id ]

properties:
  type:
    const: "dna_alignment_qc"
  status:
    $ref: _definitions#/common/properties/bundle_status
  id:
    $ref: _definitions#/common/properties/id
  program:
    $ref: _definitions#/common/properties/program_short_name
  sample_id:  # to be populated by the system
    $ref: sample#/properties/id
  dna_alignment_id:
    type: string
  analysis:
    type: object
    properties:
      analysis_type:
        const: 'QC'
      core_tool:
        const: 'Picard'
      tool:  # Tool refers to what's in GA4GH's Tool Registry Service
        type: object
        properties:
          registry:
            type: string  # such as Dockstore
          tool_id:
            type: string
          tool_name:
            type: string
          version:
            type: string
      execution:
        type: object
        properties:
          runner_name:
            type: string
          runner_version:
            type: string
          job_id:
            type: string
          started_at:
            type: string
            format: date-time
          completed_at:
            type: string
            format: date-time
  input_files:  # input file is aligned bam/cram (multi-lane)
    type: object
    properties:
      aligned_dna_seq:
        type: object
        references:
        - selfKey: [ bundle_id, object_id ]
          targetEntity: data_object
          targetKey: [ bundle_id, id ]
        properties:
          object_uri:  # if file is local, object_id will be 'null'
            type: string  # pattern: song://<repository>/<bundle_id>/<object_id>
          bundle_id:  # dna_alignment
            type: string
          object_id:  # aligned sequencing file object ID in the above dna_alignment
            type: string
          name:  # file name
            type: string
          secondary_file:  # secondary file(s), following CWL standard
            enum: [ '.bai', '.crai' ]
          repository:  # repo where the object resides
            type: string
  qc_metrics:
    type: object  # to flesh out with more metrics to be included
    properties:
      insert_size_stats:
        type: object
        properties:
          max_insert_size:
            type: integer
          mean_insert_size:
            type: integer
          median_absolute_deviation:
            type: integer
          median_insert_size:
            type: integer
          min_insert_size:
            type: integer
          mode_insert_size:
            type: integer
          pair_orientation:
            type: integer
          read_pairs:
            type: integer
          standard_deviation:
            type: integer
  files:
    type: object
    properties:
      quality_distribution:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              enum: [ "PDF" ]
            extension:
              enum: [ ".pdf.gz" ]
            date_type:
              const: "Alignment QC Plot"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      bait_bias_detail_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      quality_by_cycle:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      base_distribution_by_cycle_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      pre_adapter_summary_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      quality_by_cycle_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      insert_size_histogram:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              enum: [ "PDF" ]
            extension:
              enum: [ ".pdf.gz" ]
            date_type:
              const: "Alignment QC Plot"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      insert_size_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      quality_distribution_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      alignment_summary_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      error_summary_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      base_distribution_by_cycle:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              enum: [ "PDF" ]
            extension:
              enum: [ ".pdf.gz" ]
            date_type:
              const: "Alignment QC Plot"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      pre_adapter_detail_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      bait_bias_summary_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
      quality_yield_metrics:
        type: object
        $id: data_object
        systemProperties: [ id, bundle_id, bundle_type, format, extension, date_type, program, derived_from ]
        allOf:
        - $ref: _definitions#/data_object
        - properties:
            format:
              const: "TXT"
            extension:
              const: ".txt.gz"
            date_type:
              const: "Alignment QC Metrics"
        - properties:
            program:
              $ref: "#/properties/program"
            derived_from:
              type: object
              properties:
                type:
                  const: "dna_alignment"
                id:
                  $ref: "#/properties/dna_alignment_id"
            bundle_id:
              $ref: "#/properties/id"
            bundle_type:
              const: "dna_alignment_qc"
