{
  "name": "sequencing_experiment",
  "schema": {
    "type": "object",
    "required": [
      "experiment",
      "read_group_count",
      "read_groups"
    ],
    "properties": {
      "experiment": {
        "propertyNames": {
          "enum": [
            "submitter_sequencing_experiment_id",
            "platform",
            "experimental_strategy",
            "sequencing_date",
            "platform_model",
            "sequencing_center",
            "target_capture_kit",
            "primary_target_regions",
            "capture_target_regions",
            "number_of_genes",
            "gene_padding",
            "coverage",
            "library_selection",
            "library_isolation_protocol",
            "library_preparation_kit",
            "library_strandedness",
            "rin",
            "dv200",
            "spike_ins_included",
            "spike_ins_fasta",
            "spike_ins_concentration"
          ]
        },
        "required": [
          "platform",
          "experimental_strategy"
        ],
        "type": "object",
        "properties": {
          "submitter_sequencing_experiment_id": {
            "type": ["string", "null"],
            "pattern": "^[a-zA-Z0-9]{1}[a-zA-Z0-9\\-_\\.:']{0,98}[a-zA-Z0-9]{1}$"
          },
          "platform": {
            "enum": [
              "CAPILLARY",
              "LS454",
              "ILLUMINA",
              "SOLID",
              "HELICOS",
              "IONTORRENT",
              "ONT",
              "PACBIO",
              "Nanopore",
              "BGI"
            ]
          },
          "experimental_strategy": {
            "enum": [
              "WGS",
              "WXS",
              "RNA-Seq",
              "Bisulfite-Seq",
              "ChIP-Seq",
              "Targeted-Seq"
            ]
          },
          "sequencing_date": {
            "oneOf": [
              {
                "type": "string",
                "anyOf": [
                  {
                    "format": "date"
                  },
                  {
                    "format": "date-time"
                  }
                ],
                "example": [
                  "2019-06-16",
                  "2019-06-16T20:20:39+00:00"
                ]
              },
              {
                "type": "null"
              }
            ]
          },
          "platform_model": {
            "type": [
              "string",
              "null"
            ]
          },
          "sequencing_center": {
            "type": [
              "string",
              "null"
            ]
          },
          "target_capture_kit": {
            "type": [
              "string",
              "null"
            ] 
          },
          "primary_target_regions": {
            "type": [
              "string",
              "null"
            ] 
          },
          "capture_target_regions": {
            "type": [
              "string",
              "null"
            ] 
          },
          "number_of_genes": {
            "anyOf": [
              {
                "type": "number",
                "minimum": 1
              },
              {
                "type": "null"
              }
            ]
          },
          "gene_padding": {
            "anyOf": [
              {
                "type": "number",
                "minimum": 0
              },
              {
                "type": "null"
              }
            ]
          },
          "coverage": {
            "anyOf": [
              {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "Hotspot Regions",
                    "Coding Exons",
                    "Introns",
                    "Promoters"
                  ]
                }
              },
              {
                "type": "null"
              }
            ]
          },
          "library_selection": {
            "enum": [
              "Affinity Enrichment",
              "Hybrid Selection",
              "miRNA Size Fractionation",
              "PCR-based Enrichment",
              "Poly-T Enrichment",
              "Random",
              "rRNA Depletion",
              "Molecular Inversion Probes",
              null
            ]
          },
          "library_preparation_kit": {
            "type": [
              "string",
              "null"
            ]
          },
          "library_strandedness": {
            "enum": [
              "UNSTRANDED",
              "FIRST_READ_SENSE_STRAND",
              "FIRST_READ_ANTISENSE_STRAND",
              null
            ]
          },
          "rin": {
            "anyOf": [
              {
                "type": "number",
                "minimum": 1,
                "maximum": 10
              },
              {
                "type": "null"
              }
            ]
          },
          "dv200": {
            "anyOf": [
              {
                "type": "string",
                "pattern": "^(100|\\d{1,2}(\\.\\d+)?)%$",
                "minLength": 2,
                "description": "The percentage of RNA fragments that are >200 nucleotides in size.",
                "examples": [
                  "95%"
                ]
              },
              {
                "type": "null"
              }
            ]
          }
        },
        "allOf": [
          {
            "if": {
              "properties": {
                "experimental_strategy": {
                  "const": "RNA-Seq"
                }
              }
            },
            "then": {
              "properties": {
                "library_strandedness": {
                  "enum": [
                    "UNSTRANDED",
                    "FIRST_READ_SENSE_STRAND",
                    "FIRST_READ_ANTISENSE_STRAND"
                  ]
                }
              },
              "required": [
                "library_strandedness"
              ]
            }
          },
          {
            "if": {
              "properties": {
                "experimental_strategy": {
                  "enum": [
                    "WXS",
                    "Targeted-Seq"
                  ]
                }
              }
            },
            "then": {
              "properties": {
                "target_capture_kit": {
                  "type": "string"
                },
                "primary_target_regions": {
                  "type": "string"
                },
                "capture_target_regions": {
                  "type": "string"
                }
              },
              "required": [
                "target_capture_kit",
                "primary_target_regions",
                "capture_target_regions"
              ]
            }
          }
        ]
      },
      "read_group_count": {
        "type": "integer",
        "minimum": 1
      },
      "read_groups": {
        "type": "array",
        "items": {
          "type": "object",
          "propertyNames": {
            "enum": [
              "submitter_read_group_id",
              "read_group_id_in_bam",
              "platform_unit",
              "is_paired_end",
              "file_r1",
              "file_r2",
              "library_name",
              "read_length_r1",
              "read_length_r2",
              "insert_size",   
              "sample_barcode"  
            ]
          },
          "required": [
            "submitter_read_group_id",
            "platform_unit",
            "is_paired_end",
            "file_r1",
            "library_name"
          ],
          "allOf": [
            {
              "properties": {
                "submitter_read_group_id": {
                  "type": "string",
                  "pattern": "^[a-zA-Z0-9\\-_:\\.]+$"
                },
                "read_group_id_in_bam": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "pattern": "^[a-zA-Z0-9\\-_:\\.']+$"
                },
                "library_name": {
                  "type": "string"
                },
                "platform_unit": {
                  "type": "string"
                },
                "is_paired_end": {
                  "type": "boolean"
                },
                "file_r1": {
                  "type": "string"
                },
                "file_r2": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "read_length_r1": {
                  "type": [
                    "integer",
                    "null"
                  ],
                  "minimum": 20
                },
                "read_length_r2": {
                  "type": [
                    "integer",
                    "null"
                  ],
                  "minimum": 20
                },
                "insert_size": {
                  "type": [
                    "integer",
                    "null"
                  ],
                  "minimum": 0
                },
                "sample_barcode": {
                  "type": [
                    "string",
                    "null"
                  ]
                }
              }
            },
            {
              "if": {
                "properties": {
                  "is_paired_end": {
                    "const": true
                  }
                }
              },
              "then": {
                "properties": {
                  "file_r2": {
                    "type": "string"
                  },
                  "read_length_r2": {
                    "type": [
                      "integer",
                      "null"
                    ],
                    "minimum": 20
                  },
                  "insert_size": {
                    "type": [
                      "integer",
                      "null"
                    ],
                    "minimum": 0
                  }
                }
              },
              "else": {
                "properties": {
                  "file_r2": {
                    "const": null
                  },
                  "read_length_r2": {
                    "const": null
                  },
                  "insert_size": {
                    "const": null
                  }
                }
              }
            }
          ]
        },
        "minItems": 1
      }
    },
    "if": {
      "properties": {
        "samples": {
          "properties": {
            "specimen": {
              "properties": {
                "tumourNormalDesignation": {
                  "const": "Tumour"
                }
              }
            }
          }
        }
      }
    },
    "then": {
      "if": {
        "properties": {
          "experiment": {
            "properties": {
              "experimental_strategy": {
                "enum":[
                  "WGS",
                  "WXS"
                ]
              }
            }
          }
        }
      },
      "then": {
        "properties": {
          "samples": {
            "properties": {
              "matchedNormalSubmitterSampleId": {
                  "$ref": "#/definitions/common/submitterId"
              }
            },
            "required": [
              "matchedNormalSubmitterSampleId"
            ]
          }
        }
      },
      "else": {
        "properties": {
          "samples": {
            "properties": {
              "matchedNormalSubmitterSampleId": {
                "oneOf": [
                  {
                    "const": null
                  },
                  {
                    "$ref": "#/definitions/common/submitterId"
                  }
                ]
              }
            },
            "required": [
              "matchedNormalSubmitterSampleId"
            ]
          }
        }

      }
    },
    "else": {
      "properties": {
        "samples": {
          "properties": {
            "matchedNormalSubmitterSampleId": {
              "const": null
            }
          },
          "required": [
            "matchedNormalSubmitterSampleId"
          ]
        }
      }
    }
  }
}
