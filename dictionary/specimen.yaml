$schema: "http://json-schema.org/draft-07/schema#"

$id: "specimen"
title: Specimen
type: object
additionalProperties: false

systemProperties:
  - id

required:
  - type
  - submitter_id
  - donor_submitter_id
  - program
  - normal_or_tumour_designation
  - specimen_type

uniqueKeys:
  - [ id ]
  - [ program, submitter_id ]  # specimen submitter id must be unique within a program

references:
  - selfKey: [ program, donor_submitter_id ]
    reference:
      targetEntity: donor  # specimen to donor relationship is many-to-one
      targetKey: [ program, submitter_id ]

scriptValidations:  # script based validation, call returns True for valid or False for invalid
  - "$sumNoGreaterThan(1, [percent_tumour_cells, percent_proliferating_cells, percent_inflammatory_tissue, percent_stromal_cells, percent_necrosis])"

properties:
  type:
    enum: [ "specimen" ]
  id:
    $ref: _definitions#/core/properties/id
  program:
    type: string
  submitter_id:
    $ref: _definitions#/core/properties/submitter_id
    description: "Submitter's specimen ID"
  donor_submitter_id:
    $ref: _definitions#/core/properties/submitter_id
  normal_or_tumour_designation:
    type: string
    enum: [ $cv(tumour_or_normal_designation) ]
  specimen_type:
    enum: [ $cv(specimen_type) ]
  tumour_histology_type:
    enum: [ $cv(tumour_histology_type_icd_o_3_code) ]
  tumour_histological_type_other:
    type: string
  specimen_anatomic_site:  # from: specimen_anatomic_collection
    enum: [ $cv(anatomic_site) ]
  tumour_stage_at_specimen_acquisition:
    enum: [ $cv(tumour_stage) ]
  specimen_acquisition_interval:
    type: integer
    mininum: 0
  specimen_processing:
    enum: [ $cv(specimen_processing) ]
  specimen_storage:
    enum:
      - frozen, liquid nitrogen
      - frozen, -70 freezer
      - frozen, vapor phase
      - RNA later frozen
      - paraffin block
      - cut slide
      - other
      - not applicable
  central_pathology_confirmed:
    enum: [ "$cv(yes_no_unknown)" ]
  tumour_grading_system:
    enum: [ "default" ]
  tumour_grade:
    enum: [ Gx, G1, G2, G3, G4 ]
  percent_tumour_cells:
    type: number
    miminum: 0
    maximum: 1
  percent_proliferating_cells:
    type: number
    miminum: 0
    maximum: 1
  percent_inflammatory_tissue:
    type: number
    miminum: 0
    maximum: 1
  percent_stromal_cells:
    type: number
    miminum: 0
    maximum: 1
  percent_necrosis:
    type: number
    miminum: 0
    maximum: 1
