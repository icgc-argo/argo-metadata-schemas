$schema: "http://json-schema.org/draft-07/schema#"

$id: "sample"
title: Sample
type: object
description: ""
additionalProperties: false

definitions:
  relationDef:
    $ref: '_definitions#/relationDef'
    const:
      category: bioentity
      version: 0
      primaryKey:
      - '#/definitions/systemProperties/properties/id'
      naturalKey:
      - '#/properties/program'
      - '#/properties/submitter_id'
      uniqueKey: []
      references:
      - foreignKey:
        - '#/properties/program'
        - '#/properties/specimen_submitter_id'
        targetEntity: 'specimen'
        targetKey:  # relationship by naturalKey
        - 'specimen#/properties/program'
        - 'specimen#/properties/submitter_id'
      - foreignKey:
        - '#/definitions/systemProperties/properties/specimen_id'
        targetEntity: 'specimen'
        targetKey:  # relationship by primaryKey
        - 'specimen#/definitions/systemProperties/properties/id'
  scriptValidations:  # script based validation, call returns True for valid or False for invalid
    $ref: '_definitions#/scriptValidations'
    const:
    - "$sumNoGreaterThan(1, [percent_tumour_cells, percent_proliferating_cells, percent_inflammatory_tissue, percent_stromal_cells, percent_necrosis])"
  systemProperties:  # properties will be populated by the system
    properties:
      id:  # primary key, defined in 'primaryKey'
        allOf:
        - $ref: _definitions#/common/properties/id
        - pattern: "^SA"  # id must start with "SA", in addition to pattern defined at _definitions#/common/properties/id
      specimen_id:  # foreign key to specimen entity, the relationship is defined in 'references'
        $ref: 'specimen#/definitions/systemProperties/properties/id'

required:
- type
- submitter_id
- specimen_submitter_id
- program
- sample_type

properties:
  type:
    const: "sample"
  program:
    $ref: _definitions#/common/properties/program_short_name
  submitter_id:
    $ref: _definitions#/common/properties/submitter_id
    description: "Submitter's sample ID"
  specimen_submitter_id:
    $ref: _definitions#/common/properties/submitter_id
  sample_type:
    type: string
    scriptValidations:
    - "$cv(sample_type)"
